---
title: "ds_hw6"
author: "DITIANLI"
date: "November 25, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(leaps)
library(broom)
library(mgcv)
library(modelr)
library(knitr)
```

```{r}
homicide <- 
  read_csv("./data/homicide-data.csv") %>% 
  janitor::clean_names()
homicide 

homicide1 <- 
  homicide %>% 
  mutate(city_state = str_c(city, state, sep = ", "),
         resolved = as.numeric(disposition == "Closed by arrest")) %>% 
  filter(!city_state %in% c("Dallas,TX","Phoenix,AZ", "Kansas City,MO", "Tulsa,AL")) %>%
  filter(victim_race != "Unkonwn") %>% 
  mutate(victim_race = fct_relevel(ifelse(victim_race == "White", "white", "non-white"), "white")) %>%
  mutate(victim_age = as.numeric(victim_age))
homicide1
```
```{r}
balt <- homicide1 %>% 
  filter(city_state == "Baltimore, MD")

fit <- glm(resolved ~ victim_age + victim_sex + victim_race, data = balt, family = binomial()) %>% 
  broom::tidy()
fit
```

```{r}
fit <- fit %>% 
  mutate(OR = exp(estimate),
         CI_low = exp(estimate - std.error*1.96),
         CI_up = exp(estimate + std.error*1.96)) %>% 
  dplyr::select(term, estimate, OR, CI_low, CI_up) %>% 
    knitr::kable(digits = 2)
fit
```

```{r}
city_logistic = function(x){
  
    homicide1 %>% 
    filter(city_state == x) %>% 
    glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())  %>% 
    broom::tidy() %>% 
    mutate(OR = exp(estimate),
           CI_low = exp(estimate - 1.96 * std.error),
           CI_up = exp(estimate + 1.96 * std.error)) %>% 
    filter(term == "victim_racenon-white") %>% 
    select(beta = estimate, p.value, OR, CI_low,CI_up)
}

city_result = 
  tibble(city_state = unique(homicide1$city_state)) %>% 
  mutate(map(.x = unique(homicide1$city_state), ~city_logistic(.x))) %>% 
  unnest
```

```{r}

```

Problem 2
```{r}
birthweight<- read_csv("./data/birthweight.csv") %>% 
  janitor::clean_names() %>% 
  na.omit() %>% 
  mutate(babysex = as.factor(babysex),
         frace = as.factor(frace),
         malform = as.factor(malform),
         mrace = as.factor(mrace))

```

